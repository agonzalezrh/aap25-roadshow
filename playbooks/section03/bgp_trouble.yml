- name: Basic Troubleshooting BGP
  hosts: Delivery_Network
  gather_facts: false
  vars:
    ansible_httpapi_port: 443
    ansible_httpapi_use_ssl: true
    ansible_httpapi_validate_certs: false
    SN_HOST: "{{ lookup('env', 'SN_HOST') }}"
    SN_USERNAME: "{{ lookup('env', 'SN_USERNAME') }}"
    SN_PASSWORD: "{{ lookup('env', 'SN_PASSWORD') }}"
    api_token:
    switches:
      - ping 10.0.0.1
      - ping 10.0.0.4

  tasks:

    - name: BGP Check
      arista.eos.eos_command:
       commands: show ip bgp summary vrf all
      register: bgp_summary

    - name: Check reachability of switches
      arista.eos.eos_command:
       commands: "{{ switches }}"
      register: result

   # - set_fact:
   #    cacheable: true
   #    bgp_view: "{{ bgp_summary }}"
   #    bgp_ping: "{{ result }}"
   #    status: done
  #     bgp_state: "{{ ansible_eda.event.body.fields.session_state }}"
 #      bgp_prob_neighbor: "{{ ansible_eda.event.body.tags.neighbor_address }}"

    - name: Network Reachability
      debug:
        msg: "{{ switches }}"
        
    - name: BGP Summary details
      debug:
        msg: "{{ bgp_summary }}"

    # - name: Create incident
    #   servicenow.itsm.incident:
    #   instance:
    #    host: "{{ SN_HOST }}"
    #    username: "{{ SN_USERNAME }}"
    #    password: "{{ SN_PASSWORD }}"
    #   state: new
    #   caller: "{{ lookup('env', 'SN_USERNAME') }}"
    #   short_description: "TEST"
    #   description: "Network configurations have been backed up and uploaded"
    #   impact: high
    #   urgency: high
    #   delegate_to: localhost
      
