---
- 
  name: Create Organizational Units and Group for Ansible Admins
  hosts: windows
  gather_facts: true

  vars:
   org_unit: 
   group_name:
   sandbox:

  tasks:

   - name: Create Organizational Unit
     microsoft.ad.ou:
      name: "{{ org_unit }}"
      state: present
      protect_from_deletion: true

   - name: To view dns_domain from facts
     ansible.builtin.debug:
      msg: "{{ ansible_interfaces[0].dns_domain }}"

   - name: Get DC details
     set_fact:
       domain_name: "{{ ansible_interfaces[0].dns_domain }}"

   - name: Split and transform the domain into DC format
     set_fact:
       dc_format: >
         {{
           (domain_name.split('.')[:-1] | map('regex_replace', '^', 'DC=')) + 
           ['DC=-' + domain_name.split('.')[-1]]
         | join(', ')
         }}
    
   - name: Show the DC format
     debug:
       msg: "{{ dc_format }}"

   - name: Create a group in an OU
     microsoft.ad.group:
      identity: "{{ group_name }}"
      scope: global
    #  path: OU="{{ org_unit }}",DC="",DC=svc,DC=cluster,DC=local
    #  state: present

  
