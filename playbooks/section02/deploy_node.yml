---
- name: Deploy RHEL/Add node
  hosts: localhost
  become: true
  collections:
    - ansible.controller
    
  vars:
    node_name: 

  vars_files:
    controller_details

  tasks:

   - name: Print "Warming up the server"
     ansible.builtin.debug:
      msg: "Warming up the server"

   - name: Print "Switching on the network"
     ansible.builtin.debug:
       msg: "Switching on the network"

   - name: Print "Performing system checks"
     ansible.builtin.debug:
       msg: "Ordering Coffee"

   - name: Print "Initialization complete"
     ansible.builtin.debug:
      msg: "Making a Meme of Sean Cavanaugh"

   - name: Add Video platform inventory
     ansible.controller.inventory:
       name: "Video Platform Inventory"
       description: "Nodes used for streaming"
       organization: "Default"
       state: present
       controller_host: "{{ controller_host }}"
       controller_username: "{{ controller_username }}"
       controller_password: "{{ controller_password }}"
       validate_certs: false

   - name: Add Streaming Server hosts
     ansible.controller.host:
       name: "{{ item }}"
       description: "Application Nodes"
       inventory: "Video Platform Inventory"
       state: present
       enabled: true
       controller_host: "{{ controller_host }}"
       controller_username: "{{ controller_username }}"
       controller_password: "{{ controller_password }}"
       validate_certs: false
     loop:
       - "{{ node_name }}"
  
   - name: Add Streaming server group
     ansible.controller.group:
       name: "webservers"
       description: "Application Nodes"
       inventory: "Video Platform Inventory"
       hosts:
       - "{{ node_name }}"
       variables:
         ansible_user: rhel
       controller_host: "{{ controller_host }}"
       controller_username: "{{ controller_username }}"
       controller_password: "{{ controller_password }}"
       validate_certs: false
