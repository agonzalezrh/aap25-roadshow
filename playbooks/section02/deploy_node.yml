---
- name: Deploy RHEL/Add node
  hosts: localhost
  become: true
  collections:
    - ansible.controller
    
  vars:
    node_name: 

  vars_files:
    controller_details

  tasks:
###############INVENTORY###############

   - name: Add Video platform inventory
     ansible.controller.inventory:
       name: "Video Platform Inventory"
       description: "Nodes used for streaming"
       organization: "Default"
       state: present
       controller_host: "{{ controller_host }}"
       controller_username: "{{ controller_username }}"
       controller_password: "{{ controller_password }}"
       validate_certs: false

   - name: Add Streaming Server hosts
     ansible.controller.host:
       name: "{{ item }}"
       description: "Application Nodes"
       inventory: "Video Platform Inventory"
       state: present
       enabled: true
       controller_host: "{{ controller_host }}"
       controller_username: "{{ controller_username }}"
       controller_password: "{{ controller_password }}"
       validate_certs: false
     loop:
       - "{{ node_name }}"
  
   - name: Add Streaming server group
     ansible.controller.group:
       name: "webservers"
       description: "Application Nodes"
       inventory: "Video Platform Inventory"
       hosts:
       - "{{ node_name }}"
       variables:
         ansible_user: rhel
       controller_host: "{{ controller_host }}"
       controller_username: "{{ controller_username }}"
       controller_password: "{{ controller_password }}"
       validate_certs: false

   - name: Install apache
     ansible.builtin.package:
       name: apache2
       state: present
    
   # - name: Open firewall ports
   #   ansible.posix.firewalld:
   #     port: "{{ item }}"
   #     permanent: true
   #     state: enabled
   #   loop:
   #     - 80/tcp
   #     - 443/tcp
   #     - 22/tcp
    
   - name: Configure message of the day
     ansible.builtin.copy:
       content: "This is a test system.\n"
       dest: /etc/motd
